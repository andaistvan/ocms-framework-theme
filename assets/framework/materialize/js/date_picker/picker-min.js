!function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):this.Picker=e(jQuery)}(function($){function e(r,i,d,u){function f(){return e._.node("div",e._.node("div",e._.node("div",e._.node("div",w.component.nodes(y.open),b.box),b.wrap),b.frame),b.holder)}function l(){x.data(i,w).addClass(b.input).attr("tabindex",-1).val(x.data("value")?w.get("select",_.format):r.value),_.editable||x.on("focus."+y.id+" click."+y.id,function(e){e.preventDefault(),w.$root.eq(0).focus()}).on("keydown."+y.id,g),o(r,{haspopup:!0,expanded:!1,readonly:!1,owns:r.id+"_root"})}function p(){w.$root.on({keydown:g,focusin:function(e){w.$root.removeClass(b.focused),e.stopPropagation()},"mousedown click":function(e){var t=e.target;t!=w.$root.children()[0]&&(e.stopPropagation(),"mousedown"!=e.type||$(t).is("input, select, textarea, button, option")||(e.preventDefault(),w.$root.eq(0).focus()))}}).on({focus:function(){x.addClass(b.target)},blur:function(){x.removeClass(b.target)}}).on("focus.toOpen",h).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var e=$(this),t=e.data(),n=e.hasClass(b.navDisabled)||e.hasClass(b.disabled),o=a();o=o&&(o.type||o.href),(n||o&&!$.contains(w.$root[0],o))&&w.$root.eq(0).focus(),!n&&t.nav?w.set("highlight",w.component.item.highlight,{nav:t.nav}):!n&&"pick"in t?w.set("select",t.pick):t.clear?w.clear().close(!0):t.close&&w.close(!0)}),o(w.$root[0],"hidden",!0)}function m(){var e;_.hiddenName===!0?(e=r.name,r.name=""):(e=["string"==typeof _.hiddenPrefix?_.hiddenPrefix:"","string"==typeof _.hiddenSuffix?_.hiddenSuffix:"_submit"],e=e[0]+r.name+e[1]),w._hidden=$('<input type=hidden name="'+e+'"'+(x.data("value")||r.value?' value="'+w.get("select",_.formatSubmit)+'"':"")+">")[0],x.on("change."+y.id,function(){w._hidden.value=r.value?w.get("select",_.formatSubmit):""}),_.container?$(_.container).append(w._hidden):x.after(w._hidden)}function g(e){var t=e.keyCode,n=/^(8|46)$/.test(t);return 27==t?(w.close(),!1):void((32==t||n||!y.open&&w.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?w.clear().close():w.open()))}function h(e){e.stopPropagation(),"focus"==e.type&&w.$root.addClass(b.focused),w.open()}if(!r)return e;var v=!1,y={id:r.id||"P"+Math.abs(~~(Math.random()*new Date))},_=d?$.extend(!0,{},d.defaults,u):u||{},b=$.extend({},e.klasses(),_.klass),x=$(r),k=function(){return this.start()},w=k.prototype={constructor:k,$node:x,start:function(){return y&&y.start?w:(y.methods={},y.start=!0,y.open=!1,y.type=r.type,r.autofocus=r==a(),r.readOnly=!_.editable,r.id=r.id||y.id,"text"!=r.type&&(r.type="text"),w.component=new d(w,_),w.$root=$(e._.node("div",f(),b.picker,'id="'+r.id+'_root" tabindex="0"')),p(),_.formatSubmit&&m(),l(),_.container?$(_.container).append(w.$root):x.after(w.$root),w.on({start:w.component.onStart,render:w.component.onRender,stop:w.component.onStop,open:w.component.onOpen,close:w.component.onClose,set:w.component.onSet}).on({start:_.onStart,render:_.onRender,stop:_.onStop,open:_.onOpen,close:_.onClose,set:_.onSet}),v=t(w.$root.children()[0]),r.autofocus&&w.open(),w.trigger("start").trigger("render"))},render:function(e){return e?w.$root.html(f()):w.$root.find("."+b.box).html(w.component.nodes(y.open)),w.trigger("render")},stop:function(){return y.start?(w.close(),w._hidden&&w._hidden.parentNode.removeChild(w._hidden),w.$root.remove(),x.removeClass(b.input).removeData(i),setTimeout(function(){x.off("."+y.id)},0),r.type=y.type,r.readOnly=!1,w.trigger("stop"),y.methods={},y.start=!1,w):w},open:function(t){return y.open?w:(x.addClass(b.active),o(r,"expanded",!0),setTimeout(function(){w.$root.addClass(b.opened),o(w.$root[0],"hidden",!1)},0),t!==!1&&(y.open=!0,v&&s.css("overflow","hidden").css("padding-right","+="+n()),w.$root.eq(0).focus(),c.on("click."+y.id+" focusin."+y.id,function(e){var t=e.target;t!=r&&t!=document&&3!=e.which&&w.close(t===w.$root.children()[0])}).on("keydown."+y.id,function(t){var n=t.keyCode,o=w.component.key[n],r=t.target;27==n?w.close(!0):r!=w.$root[0]||!o&&13!=n?$.contains(w.$root[0],r)&&13==n&&(t.preventDefault(),r.click()):(t.preventDefault(),o?e._.trigger(w.component.key.go,w,[e._.trigger(o)]):w.$root.find("."+b.highlighted).hasClass(b.disabled)||w.set("select",w.component.item.highlight).close())})),w.trigger("open"))},close:function(e){return e&&(w.$root.off("focus.toOpen").eq(0).focus(),setTimeout(function(){w.$root.on("focus.toOpen",h)},0)),x.removeClass(b.active),o(r,"expanded",!1),setTimeout(function(){w.$root.removeClass(b.opened+" "+b.focused),o(w.$root[0],"hidden",!0)},0),y.open?(y.open=!1,v&&s.css("overflow","").css("padding-right","-="+n()),c.off("."+y.id),w.trigger("close")):w},clear:function(e){return w.set("clear",null,e)},set:function(e,t,n){var o,r,i=$.isPlainObject(e),a=i?e:{};if(n=i&&$.isPlainObject(t)?t:n||{},e){i||(a[e]=t);for(o in a)r=a[o],o in w.component.item&&(void 0===r&&(r=null),w.component.set(o,r,n)),"select"!=o&&"clear"!=o||x.val("clear"==o?"":w.get(o,_.format)).trigger("change");w.render()}return n.muted?w:w.trigger("set",a)},get:function(t,n){if(t=t||"value",null!=y[t])return y[t];if("valueSubmit"==t){if(w._hidden)return w._hidden.value;t="value"}if("value"==t)return r.value;if(t in w.component.item){if("string"==typeof n){var o=w.component.get(t);return o?e._.trigger(w.component.formats.toString,w.component,[n,o]):""}return w.component.get(t)}},on:function(e,t,n){var o,r,i=$.isPlainObject(e),a=i?e:{};if(e){i||(a[e]=t);for(o in a)r=a[o],n&&(o="_"+o),y.methods[o]=y.methods[o]||[],y.methods[o].push(r)}return w},off:function(){var e,t,n=arguments;for(e=0,namesCount=n.length;e<namesCount;e+=1)t=n[e],t in y.methods&&delete y.methods[t];return w},trigger:function(t,n){var o=function(t){var o=y.methods[t];o&&o.map(function(t){e._.trigger(t,w,[n])})};return o("_"+t),o(t),w}};return new k}function t(e){var t,n="position";return e.currentStyle?t=e.currentStyle[n]:window.getComputedStyle&&(t=getComputedStyle(e)[n]),"fixed"==t}function n(){if(s.height()<=d.height())return 0;var e=$('<div style="visibility:hidden;width:100px" />').appendTo("body"),t=e[0].offsetWidth;e.css("overflow","scroll");var n=$('<div style="width:100%" />').appendTo(e),o=n[0].offsetWidth;return e.remove(),t-o}function o(e,t,n){if($.isPlainObject(t))for(var o in t)r(e,o,t[o]);else r(e,t,n)}function r(e,t,n){e.setAttribute(("role"==t?"":"aria-")+t,n)}function i(e,t){$.isPlainObject(e)||(e={attribute:t}),t="";for(var n in e){var o=("role"==n?"":"aria-")+n,r=e[n];t+=null==r?"":o+'="'+e[n]+'"'}return t}function a(){try{return document.activeElement}catch(e){}}var d=$(window),c=$(document),s=$(document.documentElement);return e.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},e._={group:function(t){for(var n,o="",r=e._.trigger(t.min,t);r<=e._.trigger(t.max,t,[r]);r+=t.i)n=e._.trigger(t.item,t,[r]),o+=e._.node(t.node,n[0],n[1],n[2]);return o},node:function(e,t,n,o){return t?(t=$.isArray(t)?t.join(""):t,n=n?' class="'+n+'"':"",o=o?" "+o:"","<"+e+n+o+">"+t+"</"+e+">"):""},lead:function(e){return(e<10?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1&&this.isInteger(e.getDate())},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0},ariaAttr:i},e.extend=function(t,n){$.fn[t]=function(o,r){var i=this.data(t);return"picker"==o?i:i&&"string"==typeof o?e._.trigger(i[o],i,[r]):this.each(function(){var r=$(this);r.data(t)||new e(this,t,n,o)})},$.fn[t].defaults=n.defaults},e});